# Đồ thị dòng dữ liệu (Data Flow Diagram) - Hộp Trắng

## Hàm 1: countExcellentStudents(List<Double> điểm)

```
┌─────────────────────────────────────────────────────────────────┐
│                        DỮ LIỆU VÀO                              │
│            List<Double> điểm (danh sách điểm)                  │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                  KIỂM TRA NULL (RỖNG)                          │
│           nếu (điểm == null) trả về 0                          │
└────────────────────────┬────────────────────────────────────────┘
                         │
                    CÓ◄─┴─► KHÔNG
                    │         │
                    ▼         ▼
                 TRẢ VỀ 0   Dòng<Double>
                           (chuyển đổi danh sách thành dòng)
                            │
                            ▼
┌─────────────────────────────────────────────────────────────────┐
│            LỌC 1: Loại bỏ phần tử null                         │
│   lọc(Objects::nonNull)                                         │
│   Loại bỏ: null ✗                                               │
│   Giữ lại: các giá trị không rỗng ✓                            │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
         Dòng<Double> (đã lọc không rỗng)
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│            LỌC 2: Kiểm tra khoảng 8.0-10.0                     │
│   lọc(điểm -> điểm >= 8.0 && điểm <= 10.0)                    │
│   Loại bỏ: điểm < 8.0 ✗                                        │
│   Loại bỏ: điểm > 10.0 ✗                                       │
│   Giữ lại: 8.0 ≤ điểm ≤ 10.0 ✓                                │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
         Dòng<Double> (học sinh giỏi)
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    TẠO DỮ LIỆU TỔ HỢP                          │
│              đếm() → long                                       │
│   Đếm số lượng học sinh giỏi                                   │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    CHUYỂN ĐỔI & DỮ LIỆU RA                     │
│            (int) đếm() → int                                    │
│     Chuyển đổi long thành int                                  │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    DỮ LIỆU RA: int                              │
│     Số lượng học sinh đạt loại Giỏi                            │
└─────────────────────────────────────────────────────────────────┘
```

---

## Hàm 2: calculateValidAverage(List<Double> điểm)

```
┌─────────────────────────────────────────────────────────────────┐
│                        DỮ LIỆU VÀO                              │
│            List<Double> điểm (danh sách điểm)                  │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                  KIỂM TRA NULL (RỖNG)                          │
│           nếu (điểm == null) trả về 0.0                        │
└────────────────────────┬────────────────────────────────────────┘
                         │
                    CÓ◄─┴─► KHÔNG
                    │         │
                    ▼         ▼
               TRẢ VỀ 0.0   Dòng<Double>
                           (chuyển đổi danh sách thành dòng)
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│            LỌC 1: Loại bỏ phần tử null                         │
│   lọc(Objects::nonNull)                                         │
│   Loại bỏ: null ✗                                               │
│   Giữ lại: các giá trị không rỗng ✓                            │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
         Dòng<Double> (đã lọc không rỗng)
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│         LỌC 2: Kiểm tra khoảng hợp lệ 0.0-10.0                │
│  lọc(điểm -> điểm >= 0.0 && điểm <= 10.0)                     │
│  Loại bỏ: điểm < 0.0 ✗                                         │
│  Loại bỏ: điểm > 10.0 ✗                                        │
│  Giữ lại: 0.0 ≤ điểm ≤ 10.0 ✓                                 │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
       Dòng<Double> (chỉ các điểm hợp lệ)
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    ÁNH XẠ                                       │
│          ánh_xạ_thành_Double(Double::giá_trị_Double)          │
│   Chuyển đổi đối tượng Double → kiểu nguyên thủy double       │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
         DòngDouble (các điểm hợp lệ)
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    TẠO DỮ LIỆU TỔ HỢP                          │
│              trung_bình() → TùyChọnDouble                      │
│   Tính trung bình: tổng / số_lượng                             │
│   Ví dụ: [8.0, 9.0, 7.0] → tổng=24.0, số_lượng=3 → trung_bình=8.0  │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
      TùyChọnDouble (chứa giá trị hoặc rỗng)
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                    MỞ KHÓA & DỮ LIỆU RA                        │
│         nếu_không(0.0) → double                                │
│  Nếu TùyChọn rỗng (danh sách không có phần tử hợp lệ):       │
│      trả về 0.0                                                │
│  Nếu TùyChọn có giá trị: trả về giá trị trung bình            │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
┌─────────────────────────────────────────────────────────────────┐
│                  DỮ LIỆU RA: double                             │
│   Điểm trung bình của các điểm hợp lệ                          │
│   (hoặc 0.0 nếu không có điểm nào hợp lệ)                     │
└─────────────────────────────────────────────────────────────────┘
```

---

## So sánh hai hàm

| Tiêu chí | countExcellentStudents | calculateValidAverage |
|---------|----------------------|-------------------|
| **Dữ liệu vào** | Danh sách<Double> | Danh sách<Double> |
| **Dữ liệu ra** | int | double |
| **Lọc 1** | Loại null | Loại null |
| **Lọc 2** | điểm >= 8.0 && điểm <= 10.0 | điểm >= 0.0 && điểm <= 10.0 |
| **Tạo dữ liệu tổ hợp** | đếm() | trung_bình() |
| **Giá trị mặc định** | 0 (nếu dữ liệu vào null) | 0.0 (nếu dữ liệu vào null hoặc không có điểm hợp lệ) |

---

## Ví dụ thực thi

### Dữ liệu vào: [9.0, 8.5, 7.0, 11.0, -1.0, null]

**countExcellentStudents:**
```
Dữ liệu vào: [9.0, 8.5, 7.0, 11.0, -1.0, null]
  ↓ Lọc null
[9.0, 8.5, 7.0, 11.0, -1.0]
  ↓ Lọc 8.0-10.0
[9.0, 8.5]
  ↓ đếm()
2
```

**calculateValidAverage:**
```
Dữ liệu vào: [9.0, 8.5, 7.0, 11.0, -1.0, null]
  ↓ Lọc null
[9.0, 8.5, 7.0, 11.0, -1.0]
  ↓ Lọc 0.0-10.0
[9.0, 8.5, 7.0]
  ↓ trung_bình()
8.17 (= 24.5 / 3)
```

---

## Dòng dữ liệu toàn bộ lớp StudentAnalyzer

```
┌──────────────────────────────────────────────────────────┐
│              LỚP: StudentAnalyzer                        │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │  Phương thức 1: countExcellentStudents()           │ │
│  │  Dữ liệu vào: Danh sách<Double>                   │ │
│  │  ┌──────────────────────────────────────────────┐ │ │
│  │  │ null? ──CÓ──> trả về 0                     │ │ │
│  │  │  │                                           │ │ │
│  │  │ KHÔNG                                         │ │ │
│  │  │  │                                            │ │ │
│  │  │  └─> Dòng -> lọc(null) -> lọc(8-10)         │ │ │
│  │  │           -> đếm() -> (int) -> DL ra: int    │ │ │
│  │  └──────────────────────────────────────────────┘ │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
│  ┌────────────────────────────────────────────────────┐ │
│  │  Phương thức 2: calculateValidAverage()            │ │
│  │  Dữ liệu vào: Danh sách<Double>                   │ │
│  │  ┌──────────────────────────────────────────────┐ │ │
│  │  │ null? ──CÓ──> trả về 0.0                   │ │ │
│  │  │  │                                          │ │ │
│  │  │ KHÔNG                                        │ │ │
│  │  │  │                                           │ │ │
│  │  │  └─> Dòng -> lọc(null) -> lọc(0-10)        │ │ │
│  │  │         -> ánh_xạ_Double() -> trung_bình() │ │ │
│  │  │         -> nếu_không(0.0) -> DL ra: double │ │ │
│  │  └──────────────────────────────────────────────┘ │ │
│  └────────────────────────────────────────────────────┘ │
│                                                          │
└──────────────────────────────────────────────────────────┘
```

